rules:
  - id: cred-001
    name: AWS Credentials Access
    description: Detects access to AWS credential files
    category: credential-harvesting
    severity: high
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 80
    patterns:
      - type: file-access
        pattern: "~/.aws/credentials"
        weight: 90
        description: Direct access to AWS credentials file
      - type: file-access
        pattern: "~/.aws/config"
        weight: 60
        description: Access to AWS config file
      - type: regex
        pattern: "AKIA[0-9A-Z]{16}"
        weight: 100
        description: AWS Access Key ID pattern in code
      - type: regex
        pattern: '\.aws[/\\]credentials'
        weight: 85
        description: Reference to AWS credentials path
    remediation: |
      Remove direct access to AWS credentials. Use environment variables or IAM roles instead.

  - id: cred-002
    name: SSH Private Key Access
    description: Detects access to SSH private keys
    category: credential-harvesting
    severity: critical
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 75
    patterns:
      - type: file-access
        pattern: "~/.ssh/id_rsa"
        weight: 95
        description: Access to RSA private key
      - type: file-access
        pattern: "~/.ssh/id_ed25519"
        weight: 95
        description: Access to Ed25519 private key
      - type: regex
        pattern: "-----BEGIN (RSA |OPENSSH |DSA |EC )?PRIVATE KEY-----"
        weight: 100
        description: SSH private key content detected
      - type: regex
        pattern: '\.ssh[/\\]id_'
        weight: 80
        description: Reference to SSH key path
      - type: regex
        pattern: "open\\(.*\\.ssh[/\\\\]id_"
        weight: 90
        description: Python open() of SSH key files
    remediation: |
      SSH keys should never be accessed by AI agents. Use SSH agent forwarding or API-based access.

  - id: cred-003
    name: GCP Service Account Key
    description: Detects access to Google Cloud service account keys
    category: credential-harvesting
    severity: high
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 80
    patterns:
      - type: file-access
        pattern: "~/.config/gcloud"
        weight: 70
        description: Access to gcloud config directory
      - type: regex
        pattern: '"type":\s*"service_account"'
        weight: 90
        description: GCP service account JSON structure
      - type: regex
        pattern: '"private_key":\s*"-----BEGIN'
        weight: 100
        description: GCP private key in JSON
    remediation: |
      Use Workload Identity or Application Default Credentials instead of service account keys.

  - id: cred-004
    name: Environment Variable Harvesting
    description: Detects suspicious bulk access to environment variables
    category: credential-harvesting
    severity: medium
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 60
    patterns:
      - type: regex
        pattern: 'process\.env\[.*(KEY|SECRET|TOKEN|PASSWORD|CREDENTIAL).*\]'
        weight: 70
        description: Access to sensitive environment variables
      - type: regex
        pattern: "Object\\.keys\\(process\\.env\\)"
        weight: 80
        description: Enumeration of all environment variables
      - type: regex
        pattern: "JSON\\.stringify\\(process\\.env\\)"
        weight: 90
        description: Serialization of entire environment
      - type: regex
        pattern: 'os\.environ\[.*(KEY|SECRET|TOKEN|PASSWORD|CREDENTIAL).*\]'
        weight: 70
        description: Python os.environ access to sensitive variables
      - type: regex
        pattern: 'os\.getenv\(.*(KEY|SECRET|TOKEN|PASSWORD|CREDENTIAL).*\)'
        weight: 70
        description: Python os.getenv for sensitive variables
    remediation: |
      Only access specific, required environment variables. Never serialize the entire environment.

  - id: cred-005
    name: Browser Cookie/Credential Access
    description: Detects access to browser credential stores
    category: credential-harvesting
    severity: critical
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 85
    patterns:
      - type: file-access
        pattern: "~/Library/Application Support/Google/Chrome/*/Cookies"
        weight: 95
        description: Chrome cookies database access
      - type: file-access
        pattern: "~/Library/Application Support/Google/Chrome/*/Login Data"
        weight: 100
        description: Chrome saved passwords access
      - type: file-access
        pattern: "~/.mozilla/firefox/*/cookies.sqlite"
        weight: 95
        description: Firefox cookies database access
      - type: regex
        pattern: "Chrome.*Login Data|Firefox.*logins\\.json"
        weight: 90
        description: Browser password store reference
    remediation: |
      Never access browser credential stores. This is highly suspicious behavior.

  - id: cred-006
    name: Keychain/Credential Manager Access
    description: Detects access to OS credential managers
    category: credential-harvesting
    severity: critical
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 80
    patterns:
      - type: regex
        pattern: "security\\s+find-(generic|internet)-password"
        weight: 95
        description: macOS Keychain access via security command
      - type: import
        pattern: "keytar"
        weight: 80
        description: Node.js keychain access library
      - type: regex
        pattern: "Credential(Manager|Vault)"
        weight: 75
        description: Windows Credential Manager reference
    remediation: |
      Do not access OS credential managers directly. Request credentials through secure channels.

  - id: cred-007
    name: Git Credentials Access
    description: Detects access to Git credential storage
    category: credential-harvesting
    severity: high
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 75
    patterns:
      - type: file-access
        pattern: "~/.git-credentials"
        weight: 90
        description: Git credentials file access
      - type: file-access
        pattern: "~/.gitconfig"
        weight: 50
        description: Git config file access
      - type: regex
        pattern: "credential\\.(helper|store)"
        weight: 70
        description: Git credential helper reference
    remediation: |
      Use Git credential helpers or SSH keys instead of accessing credential files directly.

  - id: cred-008
    name: NPM Token Access
    description: Detects access to NPM authentication tokens
    category: credential-harvesting
    severity: high
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 80
    patterns:
      - type: file-access
        pattern: "~/.npmrc"
        weight: 85
        description: NPM config with potential tokens
      - type: regex
        pattern: "//registry\\.npmjs\\.org/:_authToken="
        weight: 95
        description: NPM auth token in config
      - type: regex
        pattern: "npm_[A-Za-z0-9]{36}"
        weight: 100
        description: NPM token pattern
    remediation: |
      Use npm login or CI/CD secret management instead of embedding tokens.

  - id: cred-009
    name: Docker Credentials Access
    description: Detects access to Docker authentication
    category: credential-harvesting
    severity: high
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 80
    patterns:
      - type: file-access
        pattern: "~/.docker/config.json"
        weight: 85
        description: Docker config with credentials
      - type: regex
        pattern: '"auths":\s*\{[^}]*"auth":'
        weight: 90
        description: Docker auth block in config
    remediation: |
      Use Docker credential helpers instead of storing credentials in config.json.

  - id: cred-010
    name: Kubernetes Credentials Access
    description: Detects access to Kubernetes configs
    category: credential-harvesting
    severity: high
    version: "1.0.0"
    enabled: true
    confidenceThreshold: 80
    patterns:
      - type: file-access
        pattern: "~/.kube/config"
        weight: 90
        description: Kubernetes config file access
      - type: regex
        pattern: "client-certificate-data:|client-key-data:"
        weight: 95
        description: Kubernetes client certificates
      - type: regex
        pattern: "token:\\s*[A-Za-z0-9_-]{20,}"
        weight: 85
        description: Kubernetes bearer token
    remediation: |
      Use RBAC and service accounts instead of accessing kubeconfig directly.
